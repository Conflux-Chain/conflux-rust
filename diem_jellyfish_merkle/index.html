<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This module implements `JellyfishMerkleTree` backed by storage module. The tree itself doesn’t persist anything, but realizes the logic of R/W only. The write path will produce all the intermediate results in a batch for storage layer to commit and the read path will return results directly. The public APIs are only `new`, `put_value_sets`, `put_value_set` and `get_with_proof`. After each put with a `value_set` based on a known version, the tree will return a new root hash with a `TreeUpdateBatch` containing all the new nodes and indices of stale nodes."><title>diem_jellyfish_merkle - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-cf3c48c1.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="diem_jellyfish_merkle" data-themes="" data-resource-suffix="" data-rustdoc-version="1.86.0-nightly (854f22563 2025-01-31)" data-channel="nightly" data-search-js="search-2d513d54.js" data-settings-js="settings-6dad6058.js" ><script src="../static.files/storage-302de22f.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-9b5d7e41.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../diem_jellyfish_merkle/index.html">diem_<wbr>jellyfish_<wbr>merkle</a><span class="version">0.1.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#modules">Crate Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>diem_jellyfish_merkle</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/diem_jellyfish_merkle/lib.rs.html#8-786">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This module implements <a href="struct.JellyfishMerkleTree.html"><code>JellyfishMerkleTree</code></a> backed by storage module. The
tree itself doesn’t persist anything, but realizes the logic of R/W only.
The write path will produce all the intermediate results in a batch for
storage layer to commit and the read path will return results directly. The
public APIs are only <a href="struct.JellyfishMerkleTree.html#method.new"><code>new</code></a>, <a href="struct.JellyfishMerkleTree.html#method.put_value_sets"><code>put_value_sets</code></a>, <a href="struct.JellyfishMerkleTree.html#method.put_value_set"><code>put_value_set</code></a> and
<a href="struct.JellyfishMerkleTree.html#method.get_with_proof"><code>get_with_proof</code></a>. After each put with a <code>value_set</code> based on a known
version, the tree will return a new root hash with a <a href="struct.TreeUpdateBatch.html"><code>TreeUpdateBatch</code></a>
containing all the new nodes and indices of stale nodes.</p>
<p>A Jellyfish Merkle Tree itself logically is a 256-bit sparse Merkle tree
with an optimization that any subtree containing 0 or 1 leaf node will be
replaced by that leaf node or a placeholder node with default hash value.
With this optimization we can save CPU by avoiding hashing on many sparse
levels in the tree. Physically, the tree is structurally similar to the
modified Patricia Merkle tree of Ethereum but with some modifications. A
standard Jellyfish Merkle tree will look like the following figure:</p>
<div class="example-wrap"><pre class="language-text"><code>                                   .──────────────────────.
                           _.─────&#39;                        `──────.
                      _.──&#39;                                        `───.
                  _.─&#39;                                                  `──.
              _.─&#39;                                                          `──.
            ,&#39;                                                                  `.
         ,─&#39;                                                                      &#39;─.
       ,&#39;                                                                            `.
     ,&#39;                                                                                `.
    ╱                                                                                    ╲
   ╱                                                                                      ╲
  ╱                                                                                        ╲
 ╱                                                                                          ╲
;                                                                                            :
;                                                                                            :
;                                                                                              :
│                                                                                              │
+──────────────────────────────────────────────────────────────────────────────────────────────+
.&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.
/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \
+----++----++----++----++----++----++----++----++----++----++----++----++----++----++----++----+
(  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (
 )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )
(  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (
 )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )
(  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (
 )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )
(  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (
 )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )
(  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (
■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■
■: the [`Value`] type this tree stores.</code></pre></div>
<p>A Jellyfish Merkle Tree consists of <a href="node_type/struct.InternalNode.html"><code>InternalNode</code></a> and <a href="node_type/struct.LeafNode.html"><code>LeafNode</code></a>.
<a href="node_type/struct.InternalNode.html"><code>InternalNode</code></a> is like branch node in ethereum patricia merkle with 16
children to represent a 4-level binary tree and <a href="node_type/struct.LeafNode.html"><code>LeafNode</code></a> is similar to
that in patricia merkle too. In the above figure, each <code>bell</code> in the
jellyfish is an <a href="node_type/struct.InternalNode.html"><code>InternalNode</code></a> while each tentacle is a <a href="node_type/struct.LeafNode.html"><code>LeafNode</code></a>. It
is noted that Jellyfish merkle doesn’t have a counterpart for <code>extension</code>
node of ethereum patricia merkle.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><dl class="item-table"><dt><a class="mod" href="iterator/index.html" title="mod diem_jellyfish_merkle::iterator">iterator</a></dt><dd>This module implements <code>JellyfishMerkleIterator</code>. Initialized with a version
and a key, the iterator generates all the key-value pairs in this version of
the tree, starting from the smallest key that is greater or equal to the
given key, by performing a depth first traversal on the tree.</dd><dt><a class="mod" href="metrics/index.html" title="mod diem_jellyfish_merkle::metrics">metrics</a></dt><dt><a class="mod" href="node_type/index.html" title="mod diem_jellyfish_merkle::node_type">node_<wbr>type</a></dt><dd>Node types of <a href="struct.JellyfishMerkleTree.html" title="struct diem_jellyfish_merkle::JellyfishMerkleTree"><code>JellyfishMerkleTree</code></a></dd><dt><a class="mod" href="restore/index.html" title="mod diem_jellyfish_merkle::restore">restore</a></dt><dd>This module implements the functionality to restore a <code>JellyfishMerkleTree</code>
from small chunks of accounts.</dd></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.JellyfishMerkleTree.html" title="struct diem_jellyfish_merkle::JellyfishMerkleTree">Jellyfish<wbr>Merkle<wbr>Tree</a></dt><dd>The Jellyfish Merkle tree data structure. See <a href="index.html" title="mod diem_jellyfish_merkle"><code>crate</code></a> for description.</dd><dt><a class="struct" href="struct.MissingRootError.html" title="struct diem_jellyfish_merkle::MissingRootError">Missing<wbr>Root<wbr>Error</a></dt><dt><a class="struct" href="struct.NodeStats.html" title="struct diem_jellyfish_merkle::NodeStats">Node<wbr>Stats</a></dt><dt><a class="struct" href="struct.StaleNodeIndex.html" title="struct diem_jellyfish_merkle::StaleNodeIndex">Stale<wbr>Node<wbr>Index</a></dt><dd>Indicates a node becomes stale since <code>stale_since_version</code>.</dd><dt><a class="struct" href="struct.TreeUpdateBatch.html" title="struct diem_jellyfish_merkle::TreeUpdateBatch">Tree<wbr>Update<wbr>Batch</a></dt><dd>This is a wrapper of <a href="type.NodeBatch.html"><code>NodeBatch</code></a>,
<a href="type.StaleNodeIndexBatch.html"><code>StaleNodeIndexBatch</code></a> and some stats of
nodes that represents the incremental updates of a tree and pruning indices
after applying a write set, which is a vector of <code>hashed_account_address</code>
and <code>new_value</code> pairs.</dd></dl><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><dl class="item-table"><dt><a class="constant" href="constant.ROOT_NIBBLE_HEIGHT.html" title="constant diem_jellyfish_merkle::ROOT_NIBBLE_HEIGHT">ROOT_<wbr>NIBBLE_<wbr>HEIGHT</a></dt><dd>The hardcoded maximum height of a <a href="struct.JellyfishMerkleTree.html" title="struct diem_jellyfish_merkle::JellyfishMerkleTree"><code>JellyfishMerkleTree</code></a> in nibbles.</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.TreeReader.html" title="trait diem_jellyfish_merkle::TreeReader">Tree<wbr>Reader</a></dt><dd><code>TreeReader</code> defines the interface between
<a href="struct.JellyfishMerkleTree.html"><code>JellyfishMerkleTree</code></a>
and underlying storage holding nodes.</dd><dt><a class="trait" href="trait.TreeWriter.html" title="trait diem_jellyfish_merkle::TreeWriter">Tree<wbr>Writer</a></dt><dt><a class="trait" href="trait.Value.html" title="trait diem_jellyfish_merkle::Value">Value</a></dt><dd><code>Value</code> defines the types of data that can be stored in a Jellyfish Merkle
tree.</dd></dl><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><dl class="item-table"><dt><a class="type" href="type.NodeBatch.html" title="type diem_jellyfish_merkle::NodeBatch">Node<wbr>Batch</a></dt><dd>Node batch that will be written into db atomically with other batches.</dd><dt><a class="type" href="type.StaleNodeIndexBatch.html" title="type diem_jellyfish_merkle::StaleNodeIndexBatch">Stale<wbr>Node<wbr>Index<wbr>Batch</a></dt><dd><a href="struct.StaleNodeIndex.html"><code>StaleNodeIndex</code></a> batch that will be written
into db atomically with other batches.</dd></dl><script type="text/json" id="notable-traits-data">{"Vec<u8>":"<h3>Notable traits for <code><a class=\"struct\" href=\"https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html\" title=\"struct alloc::vec::Vec\">Vec</a>&lt;<a class=\"primitive\" href=\"https://doc.rust-lang.org/nightly/std/primitive.u8.html\">u8</a>, A&gt;</code></h3><pre><code><div class=\"where\">impl&lt;A&gt; <a class=\"trait\" href=\"https://doc.rust-lang.org/nightly/std/io/trait.Write.html\" title=\"trait std::io::Write\">Write</a> for <a class=\"struct\" href=\"https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html\" title=\"struct alloc::vec::Vec\">Vec</a>&lt;<a class=\"primitive\" href=\"https://doc.rust-lang.org/nightly/std/primitive.u8.html\">u8</a>, A&gt;<div class=\"where\">where\n    A: <a class=\"trait\" href=\"https://doc.rust-lang.org/nightly/core/alloc/trait.Allocator.html\" title=\"trait core::alloc::Allocator\">Allocator</a>,</div></div>"}</script></section></div></main></body></html>