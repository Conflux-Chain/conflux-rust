<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This module implements `JellyfishMerkleTree` backed by storage module. The tree itself doesn’t persist anything, but realizes the logic of R/W only. The write path will produce all the intermediate results in a batch for storage layer to commit and the read path will return results directly. The public APIs are only `new`, `put_value_sets`, `put_value_set` and `get_with_proof`. After each put with a `value_set` based on a known version, the tree will return a new root hash with a `TreeUpdateBatch` containing all the new nodes and indices of stale nodes."><title>diem_jellyfish_merkle - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-b1a3e7f8283b8434.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="diem_jellyfish_merkle" data-themes="" data-resource-suffix="" data-rustdoc-version="1.77.0-nightly (635124704 2024-01-27)" data-channel="nightly" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-f2adc0d6ca4d09fb.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-48f368f3872407c8.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../diem_jellyfish_merkle/index.html">diem_jellyfish_merkle</a><span class="version">0.1.0</span></h2></div><div class="sidebar-elems"><ul class="block">
            <li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Aliases</a></li></ul></section></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../diem_jellyfish_merkle/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">diem_jellyfish_merkle</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/diem_jellyfish_merkle/lib.rs.html#8-786">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This module implements <a href="struct.JellyfishMerkleTree.html"><code>JellyfishMerkleTree</code></a> backed by storage module. The
tree itself doesn’t persist anything, but realizes the logic of R/W only.
The write path will produce all the intermediate results in a batch for
storage layer to commit and the read path will return results directly. The
public APIs are only <a href="struct.JellyfishMerkleTree.html#method.new"><code>new</code></a>, <a href="struct.JellyfishMerkleTree.html#method.put_value_sets"><code>put_value_sets</code></a>, <a href="struct.JellyfishMerkleTree.html#method.put_value_set"><code>put_value_set</code></a> and
<a href="struct.JellyfishMerkleTree.html#method.get_with_proof"><code>get_with_proof</code></a>. After each put with a <code>value_set</code> based on a known
version, the tree will return a new root hash with a <a href="struct.TreeUpdateBatch.html"><code>TreeUpdateBatch</code></a>
containing all the new nodes and indices of stale nodes.</p>
<p>A Jellyfish Merkle Tree itself logically is a 256-bit sparse Merkle tree
with an optimization that any subtree containing 0 or 1 leaf node will be
replaced by that leaf node or a placeholder node with default hash value.
With this optimization we can save CPU by avoiding hashing on many sparse
levels in the tree. Physically, the tree is structurally similar to the
modified Patricia Merkle tree of Ethereum but with some modifications. A
standard Jellyfish Merkle tree will look like the following figure:</p>
<div class="example-wrap"><pre class="language-text"><code>                                   .──────────────────────.
                           _.─────&#39;                        `──────.
                      _.──&#39;                                        `───.
                  _.─&#39;                                                  `──.
              _.─&#39;                                                          `──.
            ,&#39;                                                                  `.
         ,─&#39;                                                                      &#39;─.
       ,&#39;                                                                            `.
     ,&#39;                                                                                `.
    ╱                                                                                    ╲
   ╱                                                                                      ╲
  ╱                                                                                        ╲
 ╱                                                                                          ╲
;                                                                                            :
;                                                                                            :
;                                                                                              :
│                                                                                              │
+──────────────────────────────────────────────────────────────────────────────────────────────+
.&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.  .&#39;&#39;.
/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \
+----++----++----++----++----++----++----++----++----++----++----++----++----++----++----++----+
(  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (
 )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )
(  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (
 )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )
(  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (
 )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )
(  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (
 )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )  )
(  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (  (
■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■  ■
■: the [`Value`] type this tree stores.
</code></pre></div>
<p>A Jellyfish Merkle Tree consists of <a href="node_type/struct.InternalNode.html"><code>InternalNode</code></a> and <a href="node_type/struct.LeafNode.html"><code>LeafNode</code></a>.
<a href="node_type/struct.InternalNode.html"><code>InternalNode</code></a> is like branch node in ethereum patricia merkle with 16
children to represent a 4-level binary tree and <a href="node_type/struct.LeafNode.html"><code>LeafNode</code></a> is similar to
that in patricia merkle too. In the above figure, each <code>bell</code> in the
jellyfish is an <a href="node_type/struct.InternalNode.html"><code>InternalNode</code></a> while each tentacle is a <a href="node_type/struct.LeafNode.html"><code>LeafNode</code></a>. It
is noted that Jellyfish merkle doesn’t have a counterpart for <code>extension</code>
node of ethereum patricia merkle.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="iterator/index.html" title="mod diem_jellyfish_merkle::iterator">iterator</a></div><div class="desc docblock-short">This module implements <code>JellyfishMerkleIterator</code>. Initialized with a version
and a key, the iterator generates all the key-value pairs in this version of
the tree, starting from the smallest key that is greater or equal to the
given key, by performing a depth first traversal on the tree.</div></li><li><div class="item-name"><a class="mod" href="metrics/index.html" title="mod diem_jellyfish_merkle::metrics">metrics</a></div></li><li><div class="item-name"><a class="mod" href="node_type/index.html" title="mod diem_jellyfish_merkle::node_type">node_type</a></div><div class="desc docblock-short">Node types of <a href="struct.JellyfishMerkleTree.html" title="struct diem_jellyfish_merkle::JellyfishMerkleTree"><code>JellyfishMerkleTree</code></a></div></li><li><div class="item-name"><a class="mod" href="restore/index.html" title="mod diem_jellyfish_merkle::restore">restore</a></div><div class="desc docblock-short">This module implements the functionality to restore a <code>JellyfishMerkleTree</code>
from small chunks of accounts.</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.JellyfishMerkleTree.html" title="struct diem_jellyfish_merkle::JellyfishMerkleTree">JellyfishMerkleTree</a></div><div class="desc docblock-short">The Jellyfish Merkle tree data structure. See <a href="index.html" title="mod diem_jellyfish_merkle"><code>crate</code></a> for description.</div></li><li><div class="item-name"><a class="struct" href="struct.MissingRootError.html" title="struct diem_jellyfish_merkle::MissingRootError">MissingRootError</a></div></li><li><div class="item-name"><a class="struct" href="struct.NodeStats.html" title="struct diem_jellyfish_merkle::NodeStats">NodeStats</a></div></li><li><div class="item-name"><a class="struct" href="struct.StaleNodeIndex.html" title="struct diem_jellyfish_merkle::StaleNodeIndex">StaleNodeIndex</a></div><div class="desc docblock-short">Indicates a node becomes stale since <code>stale_since_version</code>.</div></li><li><div class="item-name"><a class="struct" href="struct.TreeUpdateBatch.html" title="struct diem_jellyfish_merkle::TreeUpdateBatch">TreeUpdateBatch</a></div><div class="desc docblock-short">This is a wrapper of <a href="type.NodeBatch.html"><code>NodeBatch</code></a>,
<a href="type.StaleNodeIndexBatch.html"><code>StaleNodeIndexBatch</code></a> and some stats of
nodes that represents the incremental updates of a tree and pruning indices
after applying a write set, which is a vector of <code>hashed_account_address</code>
and <code>new_value</code> pairs.</div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.ROOT_NIBBLE_HEIGHT.html" title="constant diem_jellyfish_merkle::ROOT_NIBBLE_HEIGHT">ROOT_NIBBLE_HEIGHT</a></div><div class="desc docblock-short">The hardcoded maximum height of a <a href="struct.JellyfishMerkleTree.html" title="struct diem_jellyfish_merkle::JellyfishMerkleTree"><code>JellyfishMerkleTree</code></a> in nibbles.</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.TreeReader.html" title="trait diem_jellyfish_merkle::TreeReader">TreeReader</a></div><div class="desc docblock-short"><code>TreeReader</code> defines the interface between
<a href="struct.JellyfishMerkleTree.html"><code>JellyfishMerkleTree</code></a>
and underlying storage holding nodes.</div></li><li><div class="item-name"><a class="trait" href="trait.TreeWriter.html" title="trait diem_jellyfish_merkle::TreeWriter">TreeWriter</a></div></li><li><div class="item-name"><a class="trait" href="trait.Value.html" title="trait diem_jellyfish_merkle::Value">Value</a></div><div class="desc docblock-short"><code>Value</code> defines the types of data that can be stored in a Jellyfish Merkle
tree.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.NodeBatch.html" title="type diem_jellyfish_merkle::NodeBatch">NodeBatch</a></div><div class="desc docblock-short">Node batch that will be written into db atomically with other batches.</div></li><li><div class="item-name"><a class="type" href="type.StaleNodeIndexBatch.html" title="type diem_jellyfish_merkle::StaleNodeIndexBatch">StaleNodeIndexBatch</a></div><div class="desc docblock-short"><a href="struct.StaleNodeIndex.html"><code>StaleNodeIndex</code></a> batch that will be written
into db atomically with other batches.</div></li></ul></section></div></main></body></html>